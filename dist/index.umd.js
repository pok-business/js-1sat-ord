!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("bsv-wasm"),require("buffer"),require("fs"),require("path"),require("os"),require("sigma-protocol")):"function"==typeof define&&define.amd?define(["exports","bsv-wasm","buffer","fs","path","os","sigma-protocol"],r):r((t||self).js1SatOrd={},t.bsvWasm,t.buffer,t.fs,t.path,t.os,t.sigmaProtocol)}(this,function(t,r,e,n,o,i,s){function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var u=/*#__PURE__*/a(n),c=/*#__PURE__*/a(o),d=/*#__PURE__*/a(i);function f(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function l(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return f(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?f(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}const g=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function _(t){console.log(`[dotenv@16.0.3][DEBUG] ${t}`)}const p={config:function(t){let r=c.default.resolve(process.cwd(),".env"),e="utf8";const n=Boolean(t&&t.debug),o=Boolean(t&&t.override);var i;t&&(null!=t.path&&(r="~"===(i=t.path)[0]?c.default.join(d.default.homedir(),i.slice(1)):i),null!=t.encoding&&(e=t.encoding));try{const t=p.parse(u.default.readFileSync(r,{encoding:e}));return Object.keys(t).forEach(function(r){Object.prototype.hasOwnProperty.call(process.env,r)?(!0===o&&(process.env[r]=t[r]),n&&_(!0===o?`"${r}" is already defined in \`process.env\` and WAS overwritten`:`"${r}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[r]=t[r]}),{parsed:t}}catch(t){return n&&_(`Failed to load ${r} ${t.message}`),{error:t}}},parse:function(t){const r={};let e,n=t.toString();for(n=n.replace(/\r\n?/gm,"\n");null!=(e=g.exec(n));){const t=e[1];let n=e[2]||"";n=n.trim();const o=n[0];n=n.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===o&&(n=n.replace(/\\n/g,"\n"),n=n.replace(/\\r/g,"\r")),r[t]=n}return r}};var v=p.config,m=p.parse,h=p;h.config=v,h.parse=m;var y=function(t){for(var r=[],e=0,n=t.length;e<n;e++){var o=Number(t.charCodeAt(e)).toString(16);r.push(o)}return r.join("")};v();var P=function(t,n,o,i){var s="";if(void 0!==n&&void 0!==o){var a=y("ord"),u=e.Buffer.from(n,"base64").toString("hex");s="OP_0 OP_IF "+a+" OP_1 "+y(o)+" OP_0 "+u+" OP_ENDIF"}var c=t.get_locking_script().to_asm_string()+(s?" "+s:"");if(i&&null!=i&&i.app&&null!=i&&i.type){c=c+" OP_RETURN "+y("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+y("SET");for(var d=0,f=Object.entries(i);d<f.length;d++){var l=f[d],g=l[0],_=l[1];"cmd"!==g&&(c=c+" "+y(g)+" "+y(_))}}return r.Script.from_asm_string(c)};t.P2PKH_FULL_INPUT_SIZE=148,t.P2PKH_INPUT_SCRIPT_SIZE=107,t.P2PKH_OUTPUT_SIZE=34,t.buildInscription=P,t.buildReinscriptionTemplate=function(t,n,o,i){try{var s=new r.Transaction(1,0),a=new r.TxIn(e.Buffer.from(t.txid,"hex"),t.vout,r.Script.from_asm_string(t.script));s.add_input(a);var u=P(r.P2PKHAddress.from_string(n),null==o?void 0:o.dataB64,null==o?void 0:o.contentType,i),c=new r.TxOut(BigInt(1),u);return s.add_output(c),Promise.resolve(s)}catch(t){return Promise.reject(t)}},t.createOrdinal=function(t,n,o,i,a,u,c,d,f,g){void 0===u&&(u=[]);try{var _,p=function(e){if(!f&&_&&c){var n=v.sign(c,r.SigHash.ALL|r.SigHash.FORKID,0,r.Script.from_asm_string(t.script),BigInt(t.satoshis));_.set_unlocking_script(r.Script.from_asm_string(n.to_hex()+" "+c.to_public_key().to_hex())),v.set_input(0,_)}return v},v=f||new r.Transaction(1,0);f||(_=new r.TxIn(e.Buffer.from(t.txid,"hex"),t.vout,r.Script.from_asm_string("")),v.add_input(_));var m=P(r.P2PKHAddress.from_string(n),a.dataB64,a.contentType,d),h=new r.TxOut(BigInt(1),m);v.add_output(h);for(var y,x=l(u);!(y=x()).done;){var T=y.value,I=new r.TxOut(T.amount,r.P2PKHAddress.from_string(T.to).get_locking_script());v.add_output(I)}for(var S,w=0n,O=v.get_noutputs(),b=l(Array(O).keys());!(S=b()).done;){var B;w+=(null==(B=v.get_output(S.value))?void 0:B.get_satoshis())||0n}var k=r.P2PKHAddress.from_string(o).get_locking_script(),A=Math.ceil(i*(v.get_size()+34+(f?0:107))),H=BigInt(t.satoshis)-w-BigInt(A);if(H<0)throw new Error("Inadequate satoshis for fee");if(H>0){var K=new r.TxOut(BigInt(H),k);v.add_output(K)}var j=null==g?void 0:g.idKey,E=null==g?void 0:g.keyHost,U=function(){if(!j)return function(){if(E){var t=null==g?void 0:g.authToken,r=new s.Sigma(v);return function(e,n){try{var o=Promise.resolve(r.remoteSign(E,t)).then(function(t){v=t.signedTx})}catch(t){return n(t)}return o&&o.then?o.then(void 0,n):o}(0,function(t){throw console.log(t),new Error("Remote signing to "+E+" failed")})}}();var t=new s.Sigma(v).sign(j);v=t.signedTx}();return Promise.resolve(U&&U.then?U.then(p):p())}catch(t){return Promise.reject(t)}},t.createOrdinalFromFundingTx=function(t){var e=t.fundingTx,n=t.utxos,o=t.destinationAddress,i=t.changeAddress,a=t.satPerByteFee,u=t.inscription,c=t.additionalPayments,d=void 0===c?[]:c,f=t.metadata,g=t.signer;try{var _=e,p=P(r.P2PKHAddress.from_string(o),u.dataB64,u.contentType,f),v=new r.TxOut(BigInt(1),p);_.add_output(v);for(var m,h=l(d);!(m=h()).done;){var y=m.value,x=new r.TxOut(y.amount,r.P2PKHAddress.from_string(y.to).get_locking_script());_.add_output(x)}for(var T,I=0n,S=_.get_noutputs(),w=l(Array(S).keys());!(T=w()).done;){var O;I+=(null==(O=_.get_output(T.value))?void 0:O.get_satoshis())||0n}var b=r.P2PKHAddress.from_string(i).get_locking_script(),B=Math.ceil(a*(_.get_size()+34)),k=BigInt(n.reduce(function(t,r){return t+r.satoshis},0))-I-BigInt(B);if(k<0)throw new Error("Inadequate satoshis for fee");if(k>0){var A=new r.TxOut(BigInt(k),b);_.add_output(A)}var H=null==g?void 0:g.idKey,K=new s.Sigma(_).sign(H);return Promise.resolve(K.signedTx)}catch(t){return Promise.reject(t)}},t.sendOrdinal=function(t,n,o,i,s,a,u,c,d,f){void 0===f&&(f=[]);try{var g=new r.Transaction(1,0),_=new r.TxIn(e.Buffer.from(n.txid,"hex"),n.vout,r.Script.from_asm_string(""));g.add_input(_);var p,v=new r.TxIn(e.Buffer.from(t.txid,"hex"),t.vout,r.Script.from_asm_string(""));g.add_input(v);var m=r.P2PKHAddress.from_string(u);p=null!=c&&c.dataB64&&null!=c&&c.contentType?P(m,c.dataB64,c.contentType,d):m.get_locking_script();var h=new r.TxOut(BigInt(1),p);g.add_output(h);for(var y,x=l(f);!(y=x()).done;){var T=y.value,I=new r.TxOut(T.amount,r.P2PKHAddress.from_string(T.to).get_locking_script());g.add_output(I)}for(var S,w=0n,O=g.get_noutputs(),b=l(Array(O).keys());!(S=b()).done;){var B;w+=(null==(B=g.get_output(S.value))?void 0:B.get_satoshis())||0n}var k=r.P2PKHAddress.from_string(i).get_locking_script(),A=Math.ceil(s*(g.get_size()+34+214)),H=BigInt(t.satoshis)-w-BigInt(A),K=new r.TxOut(H,k);g.add_output(K);var j=g.sign(a,r.SigHash.InputOutput,0,r.Script.from_asm_string(n.script),BigInt(n.satoshis));_.set_unlocking_script(r.Script.from_asm_string(j.to_hex()+" "+a.to_public_key().to_hex())),g.set_input(0,_);var E=g.sign(o,r.SigHash.InputOutput,1,r.Script.from_asm_string(t.script),BigInt(t.satoshis));return v.set_unlocking_script(r.Script.from_asm_string(E.to_hex()+" "+o.to_public_key().to_hex())),g.set_input(1,v),Promise.resolve(g)}catch(t){return Promise.reject(t)}},t.sendUtxos=function(t,n,o,i){try{for(var s,a=new r.Transaction(1,0),u=0,c=l(t||[]);!(s=c()).done;)u+=s.value.satoshis;var d=u-i;console.log({feeSats:i,satsIn:u,satsOut:d}),a.add_output(new r.TxOut(BigInt(d),o.get_locking_script()));for(var f,g=0,_=l(t||[]);!(f=_()).done;){var p=f.value;console.log({u:p});var v=new r.TxIn(e.Buffer.from(p.txid,"hex"),p.vout,r.Script.from_asm_string(""));console.log({inx:v}),v.set_satoshis(BigInt(p.satoshis)),a.add_input(v);var m=a.sign(n,r.SigHash.InputOutputs,g,r.Script.from_asm_string(p.script),BigInt(p.satoshis));v.set_unlocking_script(r.Script.from_asm_string(m.to_hex()+" "+n.to_public_key().to_hex())),a.set_input(g,v),g++}return Promise.resolve(a)}catch(t){return Promise.reject(t)}}});
//# sourceMappingURL=index.umd.js.map
